<!DOCTYPE html>
<html lang="pt-br">
    <head>
      <meta charset="utf-8">
      <meta name="author" content="bleny bonze">
      <title>Javascript</title>

      <style>
        .container{
          text-align: center;
          width: 300px;
          border: solid grey .5px;
          border-radius: 5px;
        }

        .display{
          display: none;
        }

        #cronometro{
          height: 25px;
          width: 100px;
          display: block;
          margin: 10px auto 0px;
        }

        .button{
          margin: 15px 10px;
          border-radius: 2px;
          height: 40px;
          color: white;
          background-color:teal;
          border: black .5px solid;
        }
      </style>
    </head>
    <body>
      <h1>Exercício: Cronometro</h1>
       
      <div class="container">
        <input type="text" id="cronometro";>
        <button class="button buttonIn" id="iniciar">Iniciar</button>
        <button class="button buttonIn" id="pausar">Pausar</button>
        <button class="button buttonIn" id="zerar">Zerar</button>
      </div>
      <script>
        (function(){
          //Variaveis de referência para os ID's do HTML
          var $cronometro = document.querySelector('#cronometro');
          var $iniciar = document.querySelector('#iniciar');
          var $pausar = document.querySelector('#pausar');
          var $zerar = document.querySelector('#zerar');

          //Adicionando evento no clicar dos botões
          $iniciar.addEventListener('click', iniciar);
          $pausar.addEventListener('click', pausar);
          $zerar.addEventListener('click', zerar);

          var intervalo = null;

          //função que inicia o cronometro de 0;
          var msClickIniciar = 0;
          var msClickPausar = 0;
          var msTempoDecorrido = 0;
          var rodando = false;

          function iniciar(){
            if(rodando) return;
            zerar();
            msClickIniciar = Date.now();
            iniciarCronometro();
            rodando = true;
            if(rodando){
              $iniciar = document.getElementById('iniciar').classList.add('display')
            }
          }

          function pausar(){
            if(!$cronometro.value) return;
            if(rodando){
              clearInterval(intervalo);
              msClickPausar = Date.now();
              msTempoDecorrido += (msClickPausar - msClickIniciar);
              $pausar.textContent = 'Retornar';
            }
            else{
              msClickIniciar = Date.now()
              iniciarCronometro(msTempoDecorrido);
              $pausar.textContent = 'Pausar';
            }
            rodando = !rodando;
          }

          function zerar(){
            msClickPausar = 0;
            msClickIniciar = 0;
            msTempoDecorrido = 0;
            rodando = false;
            clearInterval(intervalo);
            $cronometro.value = '';
            $pausar.textContent = 'Pausar';
            $iniciar = document.getElementById('iniciar').classList.remove('display');
          }

          //função que inicia o cronometro
          function iniciarCronometro(tempoDecorrido){
            var _ms = tempoDecorrido || 0;
            intervalo = setInterval(function(){
              var msAgora = Date.now();
              var diferenca = msAgora - msClickIniciar;
              $cronometro.value = formataMs(diferenca + _ms);
            },100)
          }

          function formataMs(ms){
            const MINUTO = 60000;

            if(ms < 1000){
              return ms;
            } 
            else if(ms < MINUTO){
              var s = ms/1000;
              s = parseInt(s);
              var c = ms - (s * 1000);
              return s + ':' + c;
            }
            else{
              var m = ms / MINUTO;
              m = parseInt(m);
              return m +':' + formataMs(ms - m * MINUTO);
            }
          }
        })();
      </script>
    </body>
</html>
